<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/painel.css') }}">
  <title>Lead: {{ lead.nome }}</title>
</head>
<body>
  <header>
    <div class="header-content">
      <h1>ğŸ“‹ Detalhes do Lead</h1>
      <div class="user-info">
        <a href="{{ url_for('painel') }}" class="btn-back">â† Voltar</a>
        <p> <strong>{{ usuario }}</strong></p>
        <a href="{{ url_for('logout') }}" class="btn-logout">Sair</a>
      </div>
    </div>
  </header>

  <main>
    <div class="lead-details">
      <!-- InformaÃ§Ãµes BÃ¡sicas -->
      <div class="card">
        <h2>â„¹ï¸ InformaÃ§Ãµes BÃ¡sicas</h2>
        <p><strong>Nome:</strong> {{ lead.nome }}</p>
        <p><strong>Email:</strong> <a href="mailto:{{ lead.email }}">{{ lead.email }}</a></p>
        <p><strong>Telefone:</strong> {{ lead.telefone|default('NÃ£o informado') }}</p>
        <p><strong>Mensagem:</strong> {{ lead.mensagem|default('Sem mensagem') }}</p>
        <p><strong>Origem:</strong> {{ lead.origem|default('site')|capitalize }}</p>
      </div>

      <!-- Follow-up -->
      <div class="card">
        <h2>ğŸ“Š Follow-up</h2>

        <form action="{{ url_for('atualizar_lead_followup', lead_id=lead._id) }}" method="POST">
          <div class="form-group">
            <label>Status:</label>
            <select name="status">
              <option value="novo" {% if lead.status == 'novo' %}selected{% endif %}>ğŸ†• Novo</option>
              <option value="contatado" {% if lead.status == 'contatado' %}selected{% endif %}>ğŸ“ Contatado</option>
              <option value="proposta" {% if lead.status == 'proposta' %}selected{% endif %}>ğŸ“„ Proposta Enviada</option>
              <option value="negociacao" {% if lead.status == 'negociacao' %}selected{% endif %}>ğŸ’¬ Em NegociaÃ§Ã£o</option>
              <option value="fechado" {% if lead.status == 'fechado' %}selected{% endif %}>âœ… Fechado</option>
              <option value="perdido" {% if lead.status == 'perdido' %}selected{% endif %}>âŒ Perdido</option>
            </select>
          </div>

          <div class="form-group">
            <label>Prioridade:</label>
            <select name="prioridade">
              <option value="baixa" {% if lead.prioridade == 'baixa' %}selected{% endif %}>ğŸŸ¢ Baixa</option>
              <option value="media" {% if lead.prioridade == 'media' %}selected{% endif %}>ğŸŸ¡ MÃ©dia</option>
              <option value="alta" {% if lead.prioridade == 'alta' %}selected{% endif %}>ğŸ”´ Alta</option>
            </select>
          </div>

          <div class="form-group">
            <label>Valor Estimado (R$):</label>
            <input type="number" name="valor_estimado" step="0.01" value="{{ lead.valor_estimado|default(0) }}">
          </div>

          <div class="form-group">
            <label>PrÃ³ximo Contato:</label>
            <input type="date" name="data_proximo_contato" value="{{ lead.data_proximo_contato }}">
          </div>

          <button type="submit" class="btn-primary">ğŸ’¾ Salvar AlteraÃ§Ãµes</button>
        </form>
      </div>

      <!-- Datas -->
      <div class="card">
        <h2>ğŸ“… Datas</h2>
        <p><strong>Criado em:</strong> {{ lead.data_criacao|default(lead.data) }}</p>
        <p><strong>Ãšltima interaÃ§Ã£o:</strong> {{ lead.data_ultima_interacao|default('N/A') }}</p>
        <p><strong>PrÃ³ximo contato:</strong> {{ lead.data_proximo_contato|default('NÃ£o agendado') }}</p>
      </div>

      <!-- HistÃ³rico -->
      <div class="card">
        <h2>ğŸ“ HistÃ³rico e AnotaÃ§Ãµes</h2>

        {% if lead.anotacoes %}
        <div class="anotacoes-lista">
          {% for anotacao in lead.anotacoes %}
          <div class="anotacao-item">
            <p><strong>{{ anotacao.usuario }}</strong> - {{ anotacao.data }}</p>
            <p>{{ anotacao.texto }}</p>
          </div>
          {% endfor %}
        </div>
        {% else %}
        <p>Nenhuma anotaÃ§Ã£o ainda.</p>
        {% endif %}

        <form action="{{ url_for('adicionar_anotacao_lead', lead_id=lead._id) }}" method="POST" style="margin-top: 20px;">
          <textarea name="anotacao" placeholder="Adicionar nova anotaÃ§Ã£o..." rows="4" required></textarea>
          <button type="submit" class="btn-primary">â• Adicionar AnotaÃ§Ã£o</button>
        </form>
      </div>
    </div>
  </main>
</body>
</html>
